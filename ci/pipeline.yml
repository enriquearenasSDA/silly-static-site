---
resources:
- name: 5m
  type: time
  source: {interval: 5m}

- name: bucc-aws-repo
  type: git
  source:
    uri: ((uri))
    branch: ((branch))

- name: resource-deploy-web-app
  type: cf
  source:
    api: ((api))
    username: ((username))
    password: ((password))
    organization: ((organization))
    space: ((space))
    skip_cert_check: false

jobs:
  - name: cf-push-a-git-repo
    public: true
    plan:
      - get: 5m
        trigger: true
      - get: bucc-aws-repo
        trigger: true
      - set_pipeline: panos
        file: bucc-aws-repo/ci/pipeline.yml
        vars:
          branch: main
          organization: panagiotis_xinos_gmail_com
          space: test
          uri: https://github.com/onlyascii/silly-static-site.git
          api: https://api.de.a9s.eu
      - task: build-manifest
        file: bucc-aws-repo/ci/tasks/build-manifest.yml
      - put: resource-deploy-web-app
        params:
          path: bucc-aws-repo
          show_app_log: true
          manifest: deployment-stuff/manifest.yml